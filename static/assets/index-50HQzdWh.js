import{r as t,u as H,j as e,b as B,t as N,B as C}from"./index-kFHwz8JK.js";import{C as T,a as $,b as E,d as te,c as M}from"./card-DrNz8lZA.js";import{P as ae,D as F,u as re,p as oe,a as ne,g as ce}from"./api-BXLvtwj3.js";import{L as S,R as ie,a as L}from"./radio-group-DA51Lh0o.js";import{S as le}from"./slider-BsPhRZ72.js";import{c as z,u as de,a as me,P as U,d as ue,i as pe}from"./index-B5VxRCI8.js";import{u as he}from"./index-DOwvs8IP.js";import{H as xe,M as fe}from"./main-xQPL7DdC.js";import{S as ge}from"./scroll-area-CP2hPm2I.js";import{u as je}from"./use-project-history-BNI54Bt7.js";import{U as be,A as ve}from"./upload-BRXCFycG.js";import{C as ye}from"./circle-check-big-BI68ZaLb.js";import"./index-DBJGfCaE.js";import"./index-xyIH7HPS.js";import"./index-BdQq_4o_.js";import"./separator-BPmf72Ir.js";import"./sidebar-Bqgz-xzZ.js";const ke=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],we=z("copy",ke);const Ne=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Ce=z("triangle-alert",Ne);var P="Switch",[Se]=me(P),[Pe,_e]=Se(P),O=t.forwardRef((a,d)=>{const{__scopeSwitch:n,name:x,checked:i,defaultChecked:w,required:m,disabled:f,value:o="on",onCheckedChange:g,form:p,...b}=a,[y,l]=t.useState(null),h=H(d,j=>l(j)),u=t.useRef(!1),v=y?p||!!y.closest("form"):!0,[k,_]=de({prop:i,defaultProp:w??!1,onChange:g,caller:P});return e.jsxs(Pe,{scope:n,checked:k,disabled:f,children:[e.jsx(U.button,{type:"button",role:"switch","aria-checked":k,"aria-required":m,"data-state":G(k),"data-disabled":f?"":void 0,disabled:f,value:o,...b,ref:h,onClick:ue(a.onClick,j=>{_(D=>!D),v&&(u.current=j.isPropagationStopped(),u.current||j.stopPropagation())})}),v&&e.jsx(q,{control:y,bubbles:!u.current,name:x,value:o,checked:k,required:m,disabled:f,form:p,style:{transform:"translateX(-100%)"}})]})});O.displayName=P;var V="SwitchThumb",W=t.forwardRef((a,d)=>{const{__scopeSwitch:n,...x}=a,i=_e(V,n);return e.jsx(U.span,{"data-state":G(i.checked),"data-disabled":i.disabled?"":void 0,...x,ref:d})});W.displayName=V;var De="SwitchBubbleInput",q=t.forwardRef(({__scopeSwitch:a,control:d,checked:n,bubbles:x=!0,...i},w)=>{const m=t.useRef(null),f=H(m,w),o=he(n),g=pe(d);return t.useEffect(()=>{const p=m.current;if(!p)return;const b=window.HTMLInputElement.prototype,l=Object.getOwnPropertyDescriptor(b,"checked").set;if(o!==n&&l){const h=new Event("click",{bubbles:x});l.call(p,n),p.dispatchEvent(h)}},[o,n,x]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...i,tabIndex:-1,ref:f,style:{...i.style,...g,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});q.displayName=De;function G(a){return a?"checked":"unchecked"}var Ie=O,Te=W;function $e({className:a,...d}){return e.jsx(Ie,{"data-slot":"switch",className:B("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",a),...d,children:e.jsx(Te,{"data-slot":"switch-thumb",className:B("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0 rtl:data-[state=checked]:-translate-x-[calc(100%-2px)]")})})}function Ee(){const[a,d]=t.useState(null),[n,x]=t.useState("ai"),[i,w]=t.useState(-3),[m,f]=t.useState(!0),[o,g]=t.useState("idle"),[p,b]=t.useState(0),[y,l]=t.useState(""),[h,u]=t.useState([]),[v,k]=t.useState(null),[_,j]=t.useState(!1),[D,R]=t.useState(!1),{addProject:X}=je(),J=t.useCallback(()=>{const s=h.map(c=>`[${c.type||"info"}] ${c.message}`).join(`
`),r=`=== 処理ログ ===
ファイル: ${a?.name||"不明"}
モード: ${n==="ai"?"AI声質判定":"簡易ピッチ検出"}
ピッチシフト: ${i}半音
ダブルチェック: ${m?"有効":"無効"}

${s}`;navigator.clipboard.writeText(r).then(()=>{R(!0),N.success("ログをコピーしました"),setTimeout(()=>R(!1),3e3)}).catch(()=>{N.error("コピーに失敗しました")})},[h,a,n,i,m]),K=t.useCallback(s=>{s.preventDefault(),j(!0)},[]),Q=t.useCallback(s=>{s.preventDefault(),j(!1)},[]),Y=t.useCallback(s=>{s.preventDefault(),j(!1);const r=s.dataTransfer.files[0];r&&(r.type.startsWith("video/")||r.type.startsWith("audio/"))?d(r):N.error("動画または音声ファイルをドロップしてください")},[]),Z=t.useCallback(s=>{const r=s.target.files?.[0];r&&d(r)},[]),ee=async()=>{if(!a)return;g("uploading"),b(0),l("ファイルをアップロード中..."),u([]);let s=null;try{const r=await re(a,{mode:n,pitchShift:i,doubleCheck:m,onProgress:c=>{b(c),l(`アップロード中: ${c}%`)}});s=r.task_id,k(r.task_id),g("processing"),l("処理中..."),await oe(r.task_id,c=>{b(c.progress),l(c.step||c.message||"処理中..."),c.logs&&u(c.logs)}),g("completed"),l("処理が完了しました！"),X({filename:a.name,taskId:r.task_id,mode:n,pitchShift:i,status:"completed"}),N.success("処理が完了しました！")}catch(r){g("error");const c=r instanceof Error?r.message:"エラーが発生しました";if(l(c),s)try{const I=await ne(s);I.logs&&I.logs.length>0?u(I.logs):u([{message:`エラー: ${c}`,type:"error"}])}catch{u([{message:`エラー: ${c}`,type:"error"}])}else u([{message:`エラー: ${c}`,type:"error"}]);N.error("処理に失敗しました")}},A=s=>{v&&window.open(ce(v,s),"_blank")},se=()=>{v?window.location.href=`/editor?taskId=${v}`:window.location.href="/editor"};return e.jsxs(e.Fragment,{children:[e.jsx(xe,{}),e.jsxs(fe,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"男性ボイスチェンジャー"}),e.jsx("p",{className:"text-muted-foreground",children:"AI検出で男性の声だけをピッチダウン"})]}),e.jsx("div",{className:"space-y-6 max-w-4xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(T,{children:[e.jsxs($,{children:[e.jsx(E,{children:"ファイルアップロード"}),e.jsx(te,{children:"動画または音声ファイルをドラッグ＆ドロップ、またはクリックして選択"})]}),e.jsx(M,{children:e.jsxs("div",{className:`relative border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors ${_?"border-primary bg-primary/5":a?"border-green-500 bg-green-500/5":"border-muted-foreground/25 hover:border-primary/50"}`,onDragOver:K,onDragLeave:Q,onDrop:Y,onClick:()=>document.getElementById("file-input")?.click(),children:[e.jsx("input",{id:"file-input",type:"file",accept:"video/*,audio/*",className:"hidden",onChange:Z}),e.jsx(be,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),a?e.jsx("p",{className:"text-sm font-medium",children:a.name}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"ここに動画または音声ファイルをドロップ"})]})})]}),e.jsxs(T,{children:[e.jsx($,{children:e.jsx(E,{children:"処理オプション"})}),e.jsxs(M,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(S,{children:"検出モード"}),e.jsxs(ie,{value:n,onValueChange:s=>x(s),children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{value:"ai",id:"ai"}),e.jsx(S,{htmlFor:"ai",className:"cursor-pointer",children:"AI声質判定（推奨、精度95-98%）"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{value:"simple",id:"simple"}),e.jsx(S,{htmlFor:"simple",className:"cursor-pointer",children:"簡易ピッチ検出（高速、精度70-80%）"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(S,{children:"ピッチシフト（半音）"}),e.jsx("span",{className:"text-sm font-medium",children:i})]}),e.jsx(le,{value:[i],onValueChange:([s])=>w(s),min:-12,max:12,step:.5}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"マイナス = 低く、プラス = 高く"})]}),n==="ai"&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(S,{children:"ダブルチェック"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"追加検証で精度向上"})]}),e.jsx($e,{checked:m,onCheckedChange:f})]}),e.jsx(C,{className:"w-full",size:"lg",disabled:!a||o==="uploading"||o==="processing",onClick:ee,children:o==="uploading"||o==="processing"?"処理中...":"処理開始"})]})]}),(o==="uploading"||o==="processing"||o==="completed"||o==="error")&&e.jsxs(T,{children:[e.jsx($,{children:e.jsx(E,{children:"進捗"})}),e.jsxs(M,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:y}),e.jsxs("span",{className:"font-medium",children:[p,"%"]})]}),e.jsx(ae,{value:p})]}),h.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"処理ログ"}),e.jsx(C,{variant:"outline",size:"sm",onClick:J,className:"h-7 text-xs",children:D?e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"mr-1 h-3 w-3 text-green-500"}),"コピー完了"]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"mr-1 h-3 w-3"}),"ログをコピー"]})})]}),e.jsx(ge,{className:"h-40 rounded-md border bg-muted/30 p-3",children:e.jsx("div",{className:"space-y-1 text-xs font-mono",children:h.map((s,r)=>e.jsx("div",{className:`${s.type==="error"?"text-red-500":s.type==="warning"?"text-yellow-500":"text-muted-foreground"}`,children:s.message},r))})}),(o==="completed"||o==="error")&&h.some(s=>s.message?.includes("警告")||s.message?.includes("0区間")||s.message?.includes("検出されませんでした")||s.type==="error")&&e.jsxs("div",{className:"flex items-start gap-2 rounded-md border border-yellow-500/50 bg-yellow-500/10 p-3 text-sm",children:[e.jsx(Ce,{className:"h-4 w-4 text-yellow-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-700 dark:text-yellow-400",children:"問題が発生した場合"}),e.jsx("p",{className:"text-muted-foreground text-xs mt-1",children:"「ログをコピー」ボタンでログをコピーし、開発者に送信してください。 問題の原因特定に役立ちます。"})]})]})]}),o==="completed"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(C,{onClick:()=>A("video"),className:"flex-1",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"MP4ダウンロード"]}),e.jsxs(C,{onClick:()=>A("audio"),variant:"outline",className:"flex-1",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"WAVダウンロード"]}),e.jsxs(C,{onClick:()=>se(),variant:"secondary",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"エディタ"]})]})]})]})]})})]})]})}const Qe=Ee;export{Qe as component};
